{"file_contents":{"src/main/java/com/example/sb/demo/controller/AdminController.java":{"content":"package com.example.sb.demo.controller;\n\nimport java.time.LocalDateTime;\nimport java.time.format.DateTimeFormatter;\nimport java.util.Comparator;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.stream.Collectors;\n\nimport org.springframework.core.io.ByteArrayResource;\nimport org.springframework.core.io.Resource;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.ui.Model;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.ModelAttribute;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.servlet.mvc.support.RedirectAttributes;\n\nimport com.example.sb.demo.entity.Event;\nimport com.example.sb.demo.entity.Registration;\nimport com.example.sb.demo.entity.User;\nimport com.example.sb.demo.service.EventService;\nimport com.example.sb.demo.service.RegistrationService;\nimport com.example.sb.demo.service.UserService;\n\nimport jakarta.servlet.http.HttpSession;\n\n@Controller\n@RequestMapping(\"/admin\")\npublic class AdminController {\n\n    private final UserService userService;\n    private final EventService eventService;\n    private final RegistrationService registrationService;\n\n    // ✅ Constructor injection (manual version of @RequiredArgsConstructor)\n    \n    public AdminController(UserService userService,\n                           EventService eventService,\n                           RegistrationService registrationService) {\n        this.userService = userService;\n        this.eventService = eventService;\n        this.registrationService = registrationService;\n    }\n\n    private User getCurrentAdmin(HttpSession session) {\n        Optional<User> userOpt = userService.getCurrentUser(session);\n\n        if (userOpt.isEmpty()) {\n            throw new RuntimeException(\"You are not logged in. Please login as admin.\");\n        }\n\n        User user = userOpt.get();\n\n        if (!userService.isAdmin(user)) {\n            throw new RuntimeException(\"Access denied. Admin privileges required.\");\n        }\n\n        session.setAttribute(\"isAdmin\", true);\n        return user;\n    }\n\n\n\n    @ModelAttribute\n    public void addCommonAttributes(Model model, HttpSession session) {\n        try {\n            User admin = getCurrentAdmin(session);\n            model.addAttribute(\"user\", admin);\n            model.addAttribute(\"isAdmin\", true);\n        } catch (Exception e) {\n            // ignore - unauthenticated requests will be routed to login\n        }\n    }\n\n    @GetMapping\n    public String adminHome() {\n        return \"redirect:/admin/dashboard\";\n    }\n\n    @GetMapping(\"/dashboard\")\n    public String dashboard(Model model, HttpSession session) {\n        getCurrentAdmin(session);\n\n        List<Event> allEvents = eventService.getAllEvents();\n        List<Event> upcomingEvents = eventService.getUpcomingEvents();\n        List<Event> pastEvents = eventService.getPastEvents();\n        List<Registration> allRegistrations = registrationService.getAllRegistrations();\n        List<User> allUsers = userService.getAllUsers();\n\n        Map<String, Long> registrationStats = allRegistrations.stream()\n                .collect(Collectors.groupingBy(Registration::getStatus, Collectors.counting()));\n\n        Map<String, Long> userStats = allUsers.stream()\n                .collect(Collectors.groupingBy(User::getRole, Collectors.counting()));\n\n        model.addAttribute(\"stats\", Map.of(\n                \"totalEvents\", allEvents.size(),\n                \"upcomingEvents\", upcomingEvents.size(),\n                \"pastEvents\", pastEvents.size(),\n                \"totalRegistrations\", allRegistrations.size(),\n                \"pendingRegistrations\", registrationStats.getOrDefault(\"PENDING\", 0L),\n                \"approvedRegistrations\", registrationStats.getOrDefault(\"APPROVED\", 0L),\n                \"rejectedRegistrations\", registrationStats.getOrDefault(\"REJECTED\", 0L),\n                \"totalUsers\", allUsers.size(),\n                \"totalStudents\", userStats.getOrDefault(\"STUDENT\", 0L),\n                \"totalAdmins\", userStats.getOrDefault(\"ADMIN\", 0L)\n        ));\n\n        model.addAttribute(\"recentEvents\",\n                allEvents.stream()\n                        .sorted(Comparator.comparing(Event::getCreatedAt).reversed())\n                        .limit(5)\n                        .collect(Collectors.toList()));\n\n        model.addAttribute(\"recentRegistrations\",\n                allRegistrations.stream()\n                        .sorted(Comparator.comparing(Registration::getRegistrationDate).reversed())\n                        .limit(5)\n                        .collect(Collectors.toList()));\n\n        model.addAttribute(\"pendingApprovals\", registrationService.getPendingRegistrations());\n\n        return \"admin/dashboard\";\n    }\n\n    @GetMapping(\"/events/manage\")\n    public String manageEvents(Model model) {\n        model.addAttribute(\"events\", eventService.getAllEvents());\n        return \"admin/events\";\n    }\n\n    @PostMapping(\"/events/{eventId}/approve\")\n    public String approveEvent(@PathVariable Long eventId,\n                               HttpSession session,\n                               RedirectAttributes redirectAttributes) {\n        try {\n            User admin = getCurrentAdmin(session);\n            eventService.approveEvent(eventId, admin);\n            redirectAttributes.addFlashAttribute(\"successMessage\", \"Event approved successfully\");\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n        }\n        return \"redirect:/admin/events/manage\";\n    }\n\n    @PostMapping(\"/events/{eventId}/reject\")\n    public String rejectEvent(@PathVariable Long eventId,\n                              @RequestParam(required = false) String reason,\n                              HttpSession session,\n                              RedirectAttributes redirectAttributes) {\n        try {\n            User admin = getCurrentAdmin(session);\n            eventService.rejectEvent(eventId, reason, admin);\n            redirectAttributes.addFlashAttribute(\"successMessage\", \"Event rejected successfully\");\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n        }\n        return \"redirect:/admin/events/manage\";\n    }\n\n    @GetMapping(\"/users\")\n    public String manageUsers(Model model,\n                              @RequestParam(required = false) String role,\n                              @RequestParam(required = false) String query) {\n        List<User> users = userService.getAllUsers();\n\n        if (role != null && !role.isEmpty()) {\n            users = users.stream()\n                    .filter(user -> role.equals(user.getRole()))\n                    .collect(Collectors.toList());\n        }\n\n        if (query != null && !query.isEmpty()) {\n            String searchQuery = query.toLowerCase();\n            users = users.stream()\n                    .filter(user ->\n                            user.getUsername().toLowerCase().contains(searchQuery) ||\n                                    user.getFullName().toLowerCase().contains(searchQuery) ||\n                                    user.getEmail().toLowerCase().contains(searchQuery))\n                    .collect(Collectors.toList());\n        }\n\n        model.addAttribute(\"users\", users);\n        model.addAttribute(\"selectedRole\", role);\n        model.addAttribute(\"searchQuery\", query);\n        return \"admin/users\";\n    }\n\n    @PostMapping(\"/users/{userId}/role\")\n    public String updateUserRole(@PathVariable Long userId,\n                                 @RequestParam String role,\n                                 HttpSession session,\n                                 RedirectAttributes redirectAttributes) {\n        try {\n            User admin = getCurrentAdmin(session);\n            userService.updateUserRole(userId, role, admin);\n            redirectAttributes.addFlashAttribute(\"successMessage\",\n                    \"User role updated successfully\");\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n        }\n        return \"redirect:/admin/users\";\n    }\n\n    @PostMapping(\"/users/{userId}/status\")\n    public String updateUserStatus(@PathVariable Long userId,\n                                   @RequestParam boolean active,\n                                   HttpSession session,\n                                   RedirectAttributes redirectAttributes) {\n        try {\n            User admin = getCurrentAdmin(session);\n            userService.updateUserStatus(userId, active, admin);\n            redirectAttributes.addFlashAttribute(\"successMessage\",\n                    \"User status updated successfully\");\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n        }\n        return \"redirect:/admin/users\";\n    }\n\n    @GetMapping(\"/registrations\")\n    public String viewRegistrations(@RequestParam(required = false) Long eventId,\n                                    @RequestParam(required = false) String status,\n                                    @RequestParam(required = false) String department,\n                                    Model model,\n                                    HttpSession session) {\n        getCurrentAdmin(session);\n\n        List<Registration> registrations;\n        if (eventId != null) {\n            Event event = eventService.getEventById(eventId);\n            model.addAttribute(\"event\", event);\n            registrations = registrationService.getEventRegistrations(event);\n        } else {\n            registrations = registrationService.getAllRegistrations();\n        }\n\n        if (status != null && !status.isEmpty()) {\n            registrations = registrations.stream()\n                    .filter(r -> status.equals(r.getStatus()))\n                    .collect(Collectors.toList());\n        }\n\n        if (department != null && !department.isEmpty()) {\n            registrations = registrations.stream()\n                    .filter(r -> department.equals(r.getUser().getDepartment()))\n                    .collect(Collectors.toList());\n        }\n\n        model.addAttribute(\"registrations\", registrations);\n        model.addAttribute(\"events\", eventService.getAllEvents());\n        model.addAttribute(\"selectedEvent\", eventId);\n        model.addAttribute(\"selectedStatus\", status);\n        model.addAttribute(\"selectedDepartment\", department);\n        model.addAttribute(\"departments\", userService.getAllDepartments());\n\n        return \"admin/registrations\";\n    }\n\n    @PostMapping(\"/registrations/{registrationId}/status\")\n    public String updateRegistrationStatus(@PathVariable Long registrationId,\n                                           @RequestParam String status,\n                                           @RequestParam(required = false) String comment,\n                                           HttpSession session,\n                                           RedirectAttributes redirectAttributes) {\n        try {\n            User admin = getCurrentAdmin(session);\n            Registration registration = registrationService.updateRegistrationStatus(\n                    registrationId, status, comment, admin);\n\n            redirectAttributes.addFlashAttribute(\"successMessage\",\n                    \"Registration status updated to \" + status);\n            return \"redirect:/admin/registrations?eventId=\" + registration.getEvent().getId();\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n            return \"redirect:/admin/registrations\";\n        }\n    }\n\n    @GetMapping(\"/registrations/export\")\n    public ResponseEntity<Resource> exportRegistrations(\n            @RequestParam(required = false) Long eventId,\n            @RequestParam(required = false, defaultValue = \"csv\") String format) {\n\n        try {\n            String filename = \"registrations_\" + LocalDateTime.now().format(\n                    DateTimeFormatter.ofPattern(\"yyyyMMdd_HHmmss\")) + \".\" + format;\n\n            byte[] data = registrationService.exportRegistrations(eventId, format);\n\n            MediaType mediaType = switch (format.toLowerCase()) {\n                case \"xlsx\" -> MediaType.parseMediaType(\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\");\n                case \"csv\" -> MediaType.TEXT_PLAIN;\n                default -> MediaType.APPLICATION_OCTET_STREAM;\n            };\n\n            return ResponseEntity.ok()\n                    .header(HttpHeaders.CONTENT_DISPOSITION, \"attachment; filename=\" + filename)\n                    .contentType(mediaType)\n                    .body(new ByteArrayResource(data));\n        } catch (Exception e) {\n            throw new RuntimeException(\"Error exporting registrations: \" + e.getMessage());\n        }\n    }\n\n    @GetMapping(\"/reports\")\n    public String viewReports(Model model,\n                              @RequestParam(required = false) String type,\n                              @RequestParam(required = false) String period) {\n        LocalDateTime startDate = getStartDateForPeriod(period);\n\n        Map<String, Object> reportData = switch (type) {\n            case \"events\" -> generateEventReport(startDate);\n            case \"registrations\" -> generateRegistrationReport(startDate);\n            case \"users\" -> generateUserReport(startDate);\n            default -> Map.of(\"error\", \"Invalid report type\");\n        };\n\n        model.addAttribute(\"reportData\", reportData);\n        model.addAttribute(\"selectedType\", type);\n        model.addAttribute(\"selectedPeriod\", period);\n        return \"admin/reports\";\n    }\n\n    private LocalDateTime getStartDateForPeriod(String period) {\n        LocalDateTime now = LocalDateTime.now();\n        return switch (period) {\n            case \"week\" -> now.minusWeeks(1);\n            case \"month\" -> now.minusMonths(1);\n            case \"year\" -> now.minusYears(1);\n            default -> now.minusMonths(1);\n        };\n    }\n\n    private Map<String, Object> generateEventReport(LocalDateTime startDate) {\n        List<Event> events = eventService.getEventsByDateRange(startDate, LocalDateTime.now());\n        return Map.of(\n                \"totalEvents\", events.size(),\n                \"eventsData\", events,\n                \"eventsByDepartment\", events.stream()\n                        .collect(Collectors.groupingBy(\n                                e -> e.getCreatedBy().getDepartment(),\n                                Collectors.counting()\n                        ))\n        );\n    }\n\n    private Map<String, Object> generateRegistrationReport(LocalDateTime startDate) {\n        List<Registration> registrations = registrationService.getRegistrationsByDateRange(startDate, LocalDateTime.now());\n        return Map.of(\n                \"totalRegistrations\", registrations.size(),\n                \"registrationsData\", registrations,\n                \"registrationsByStatus\", registrations.stream()\n                        .collect(Collectors.groupingBy(\n                                Registration::getStatus,\n                                Collectors.counting()\n                        ))\n        );\n    }\n\n    private Map<String, Object> generateUserReport(LocalDateTime startDate) {\n        List<User> users = userService.getUsersByDateRange(startDate, LocalDateTime.now());\n        return Map.of(\n                \"totalUsers\", users.size(),\n                \"usersData\", users,\n                \"usersByRole\", users.stream()\n                        .collect(Collectors.groupingBy(\n                                User::getRole,\n                                Collectors.counting()\n                        ))\n        );\n    }\n}\n","size_bytes":16087},"src/main/java/com/example/sb/demo/entity/Event.java":{"content":"package com.example.sb.demo.entity;\n\nimport jakarta.persistence.*;\n\nimport java.time.LocalDateTime;\n\n@Entity\n@Table(name = \"events\")\n\npublic class Event {\n    public Long getId() {\n\t\treturn id;\n\t}\n\n\tpublic void setId(Long id) {\n\t\tthis.id = id;\n\t}\n\n\tpublic String getTitle() {\n\t\treturn title;\n\t}\n\n\tpublic void setTitle(String title) {\n\t\tthis.title = title;\n\t}\n\n\tpublic String getDescription() {\n\t\treturn description;\n\t}\n\n\tpublic void setDescription(String description) {\n\t\tthis.description = description;\n\t}\n\n\tpublic LocalDateTime getEventDate() {\n\t\treturn eventDate;\n\t}\n\n\tpublic void setEventDate(LocalDateTime eventDate) {\n\t\tthis.eventDate = eventDate;\n\t}\n\n\tpublic String getVenue() {\n\t\treturn venue;\n\t}\n\n\tpublic void setVenue(String venue) {\n\t\tthis.venue = venue;\n\t}\n\n\tpublic String getImageUrl() {\n\t\treturn imageUrl;\n\t}\n\n\tpublic void setImageUrl(String imageUrl) {\n\t\tthis.imageUrl = imageUrl;\n\t}\n\n\tpublic Integer getMaxParticipants() {\n\t\treturn maxParticipants;\n\t}\n\n\tpublic void setMaxParticipants(Integer maxParticipants) {\n\t\tthis.maxParticipants = maxParticipants;\n\t}\n\n\tpublic User getCreatedBy() {\n\t\treturn createdBy;\n\t}\n\n\tpublic void setCreatedBy(User createdBy) {\n\t\tthis.createdBy = createdBy;\n\t}\n\n\tpublic LocalDateTime getCreatedAt() {\n\t\treturn createdAt;\n\t}\n\n\tpublic void setCreatedAt(LocalDateTime createdAt) {\n\t\tthis.createdAt = createdAt;\n\t}\n\n\tpublic LocalDateTime getUpdatedAt() {\n\t\treturn updatedAt;\n\t}\n\n\tpublic void setUpdatedAt(LocalDateTime updatedAt) {\n\t\tthis.updatedAt = updatedAt;\n\t}\n\n\tpublic String getStatus() {\n\t\treturn status;\n\t}\n\n\tpublic void setStatus(String status) {\n\t\tthis.status = status;\n\t}\n\n\t@Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(nullable = false)\n    private String title;\n\n    @Column(nullable = false, length = 1000)\n    private String description;\n\n    @Column(nullable = false)\n    private LocalDateTime eventDate;\n\n    @Column(nullable = false)\n    private String venue;\n\n    private String imageUrl;\n    \n    private Integer maxParticipants;\n    \n    @ManyToOne(fetch = FetchType.EAGER)\n    @JoinColumn(name = \"created_by\", nullable = false)\n    private User createdBy;\n\n    @Column(nullable = false)\n    private LocalDateTime createdAt;\n\n    private LocalDateTime updatedAt;\n\n    private String status; // PENDING, APPROVED, REJECTED\n    \n    private String name;\n\n    public String getName() {\n\t\treturn name;\n\t}\n\n\tpublic void setName(String name) {\n\t\tthis.name = name;\n\t}\n\n\t@PrePersist\n    protected void onCreate() {\n        createdAt = LocalDateTime.now();\n        if (status == null) {\n            status = \"PENDING\";\n        }\n    }\n\n    @PreUpdate\n    protected void onUpdate() {\n        updatedAt = LocalDateTime.now();\n    }\n    \n\n}","size_bytes":2737},"src/main/java/com/example/sb/demo/repository/RegistrationRepository.java":{"content":"package com.example.sb.demo.repository;\n\nimport com.example.sb.demo.entity.Event;\nimport com.example.sb.demo.entity.Registration;\nimport com.example.sb.demo.entity.User;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport java.util.List;\nimport java.util.Optional;\n\npublic interface RegistrationRepository extends JpaRepository<Registration, Long> {\n    List<Registration> findByUser(User user);\n    List<Registration> findByEvent(Event event);\n    Optional<Registration> findByEventAndUser(Event event, User user);\n    boolean existsByEventAndUser(Event event, User user);\n    List<Registration> findByEventAndStatus(Event event, String status);\n    List<Registration> findByUserAndStatus(User user, String status);\n}","size_bytes":735},"src/main/java/com/example/sb/demo/service/EventService.java":{"content":"package com.example.sb.demo.service;\n\nimport java.time.LocalDateTime;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport com.example.sb.demo.entity.Event;\nimport com.example.sb.demo.entity.User;\nimport com.example.sb.demo.repository.EventRepository;\n\nimport lombok.RequiredArgsConstructor;\n\n@Service\n@RequiredArgsConstructor\npublic class EventService {\n\t  private final EventRepository eventRepository;\n\n\t    // ✅ Constructor Injection (preferred)\n\t   \n\t    public EventService(EventRepository eventRepository) {\n\t        this.eventRepository = eventRepository;\n\t    }\n\n    public List<Event> getAllEvents() {\n        return eventRepository.findAllByOrderByEventDateDesc();\n    }\n\n    public Event getEventById(Long id) {\n        return eventRepository.findById(id)\n                .orElseThrow(() -> new RuntimeException(\"Event not found with ID: \" + id));\n    }\n\n    public List<Event> getUpcomingEvents() {\n        return eventRepository.findByEventDateAfterOrderByEventDateAsc(LocalDateTime.now());\n    }\n\n    public List<Event> getUserEvents(User user) {\n        return eventRepository.findByCreatedBy(user);\n    }\n\n    public List<Event> getPastEvents() {\n        return eventRepository.findByEventDateBeforeOrderByEventDateDesc(LocalDateTime.now());\n    }\n\n    public List<Event> getEventsByDateRange(LocalDateTime start, LocalDateTime end) {\n        return eventRepository.findAll().stream()\n                .filter(e -> e.getEventDate() != null &&\n                        (e.getEventDate().isEqual(start) || e.getEventDate().isAfter(start)) &&\n                        (e.getEventDate().isEqual(end) || e.getEventDate().isBefore(end)))\n                .collect(Collectors.toList());\n    }\n\n    @Transactional\n    public Event approveEvent(Long eventId, User admin) {\n        if (!\"ADMIN\".equals(admin.getRole())) {\n            throw new RuntimeException(\"Only admins can approve events\");\n        }\n        Event event = getEventById(eventId);\n        event.setStatus(\"APPROVED\");\n        return eventRepository.save(event);\n    }\n\n    @Transactional\n    public Event rejectEvent(Long eventId, String reason, User admin) {\n        if (!\"ADMIN\".equals(admin.getRole())) {\n            throw new RuntimeException(\"Only admins can reject events\");\n        }\n        Event event = getEventById(eventId);\n        event.setStatus(\"REJECTED\");\n        // reason is currently not persisted (no field). Could be logged or stored in future.\n        return eventRepository.save(event);\n    }\n\n//    @Transactional\n//    public Event createEvent(Event event, User user) {\n//        event.setCreatedBy(user);\n//        return eventRepository.save(event);\n//    }\n\n    @Transactional\n    public Event updateEvent(Long id, Event eventDetails, User user) {\n        Event event = eventRepository.findById(id)\n                .orElseThrow(() -> new RuntimeException(\"Event not found\"));\n\n        if (!isAuthorizedToModify(event, user)) {\n            throw new RuntimeException(\"Not authorized to modify this event\");\n        }\n\n        event.setTitle(eventDetails.getTitle());\n        event.setDescription(eventDetails.getDescription());\n        event.setEventDate(eventDetails.getEventDate());\n        event.setVenue(eventDetails.getVenue());\n        event.setImageUrl(eventDetails.getImageUrl());\n        event.setMaxParticipants(eventDetails.getMaxParticipants());\n\n        return eventRepository.save(event);\n    }\n\n    @Transactional\n    public void deleteEvent(Long id, User user) {\n        Event event = eventRepository.findById(id)\n                .orElseThrow(() -> new RuntimeException(\"Event not found\"));\n\n        if (!isAuthorizedToModify(event, user)) {\n            throw new RuntimeException(\"Not authorized to delete this event\");\n        }\n\n        eventRepository.delete(event);\n    }\n\n    private boolean isAuthorizedToModify(Event event, User user) {\n        return user.getRole().equals(\"ADMIN\") || event.getCreatedBy().getId().equals(user.getId());\n    }\n    \n    @Transactional\n    public Event createEvent(Event event, User creator) {\n        event.setCreatedBy(creator); // ✅ Important for ownership\n        event.setCreatedAt(LocalDateTime.now());\n        return eventRepository.save(event);\n    }\n\n}","size_bytes":4348},"src/main/java/com/example/sb/demo/entity/User.java":{"content":"package com.example.sb.demo.entity;\n\nimport jakarta.persistence.*;\n\n\n@Entity\n@Table(name = \"users\")\n\npublic class User {\n    public Long getId() {\n\t\treturn id;\n\t}\n\tpublic void setId(Long id) {\n\t\tthis.id = id;\n\t}\n\tpublic String getUsername() {\n\t\treturn username;\n\t}\n\tpublic void setUsername(String username) {\n\t\tthis.username = username;\n\t}\n\tpublic String getPassword() {\n\t\treturn password;\n\t}\n\tpublic void setPassword(String password) {\n\t\tthis.password = password;\n\t}\n\tpublic String getEmail() {\n\t\treturn email;\n\t}\n\tpublic void setEmail(String email) {\n\t\tthis.email = email;\n\t}\n\tpublic String getRole() {\n\t\treturn role;\n\t}\n\tpublic void setRole(String role) {\n\t\tthis.role = role;\n\t}\n\tpublic String getFullName() {\n\t\treturn fullName;\n\t}\n\tpublic void setFullName(String fullName) {\n\t\tthis.fullName = fullName;\n\t}\n\tpublic String getStudentId() {\n\t\treturn studentId;\n\t}\n\tpublic void setStudentId(String studentId) {\n\t\tthis.studentId = studentId;\n\t}\n\tpublic String getDepartment() {\n\t\treturn department;\n\t}\n\tpublic void setDepartment(String department) {\n\t\tthis.department = department;\n\t}\n\tpublic Integer getYear() {\n\t\treturn year;\n\t}\n\tpublic void setYear(Integer year) {\n\t\tthis.year = year;\n\t}\n\t@Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(nullable = false, unique = true)\n    private String username;\n\n    @Column(nullable = false)\n    private String password;\n\n    @Column(nullable = false)\n    private String email;\n\n    @Column(nullable = false)\n    private String role; // \"ADMIN\" or \"STUDENT\"\n\n    @Column(nullable = false)\n    private String fullName;\n\n    // Additional fields for students\n    private String studentId;\n    private String department;\n    private Integer year;\n}","size_bytes":1731},"src/main/resources/static/js/main.js":{"content":"// Show notification\nfunction showNotification(message, type = 'success') {\n    const notification = document.createElement('div');\n    notification.className = `notification ${type}`;\n    notification.textContent = message;\n    document.body.appendChild(notification);\n\n    setTimeout(() => {\n        notification.style.animation = 'slideOut 0.3s forwards';\n        setTimeout(() => notification.remove(), 300);\n    }, 3000);\n}\n\n// Form validation\nfunction validateForm(formElement) {\n    const inputs = formElement.querySelectorAll('input[required], textarea[required]');\n    let isValid = true;\n\n    inputs.forEach(input => {\n        if (!input.value.trim()) {\n            isValid = false;\n            input.classList.add('is-invalid');\n            const feedback = input.nextElementSibling || document.createElement('div');\n            feedback.className = 'invalid-feedback';\n            feedback.textContent = 'This field is required';\n            if (!input.nextElementSibling) {\n                input.parentNode.appendChild(feedback);\n            }\n        } else {\n            input.classList.remove('is-invalid');\n            if (input.nextElementSibling?.className === 'invalid-feedback') {\n                input.nextElementSibling.remove();\n            }\n        }\n    });\n\n    return isValid;\n}\n\n// Image preview\nfunction previewImage(input) {\n    if (input.files && input.files[0]) {\n        const reader = new FileReader();\n        reader.onload = function(e) {\n            const preview = document.querySelector('#imagePreview');\n            preview.src = e.target.result;\n            preview.style.display = 'block';\n        }\n        reader.readAsDataURL(input.files[0]);\n    }\n}\n\n// Countdown timer for events\nfunction initCountdown(eventDate, elementId) {\n    const countdownElement = document.getElementById(elementId);\n    if (!countdownElement) return;\n\n    function updateCountdown() {\n        const now = new Date().getTime();\n        const distance = new Date(eventDate).getTime() - now;\n\n        const days = Math.floor(distance / (1000 * 60 * 60 * 24));\n        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));\n        const seconds = Math.floor((distance % (1000 * 60)) / 1000);\n\n        countdownElement.innerHTML = `\n            <div class=\"countdown-item\">${days}d</div>\n            <div class=\"countdown-item\">${hours}h</div>\n            <div class=\"countdown-item\">${minutes}m</div>\n            <div class=\"countdown-item\">${seconds}s</div>\n        `;\n\n        if (distance < 0) {\n            clearInterval(timer);\n            countdownElement.innerHTML = '<div class=\"event-ended\">Event has ended</div>';\n        }\n    }\n\n    updateCountdown();\n    const timer = setInterval(updateCountdown, 1000);\n}\n\n// Infinite scroll for events\nlet page = 1;\nlet loading = false;\n\nfunction loadMoreEvents() {\n    if (loading) return;\n    \n    const eventContainer = document.querySelector('.event-container');\n    if (!eventContainer) return;\n\n    loading = true;\n    const loadingSpinner = document.createElement('div');\n    loadingSpinner.className = 'loading-spinner mx-auto mt-4';\n    eventContainer.appendChild(loadingSpinner);\n\n    fetch(`/api/events?page=${page}`)\n        .then(response => response.json())\n        .then(data => {\n            loadingSpinner.remove();\n            if (data.length > 0) {\n                data.forEach(event => {\n                    const eventCard = createEventCard(event);\n                    eventContainer.appendChild(eventCard);\n                });\n                page++;\n            }\n            loading = false;\n        })\n        .catch(error => {\n            console.error('Error loading events:', error);\n            loadingSpinner.remove();\n            loading = false;\n        });\n}\n\n// Event card template\nfunction createEventCard(event) {\n    const card = document.createElement('div');\n    card.className = 'event-card animate-fade-in-up mb-4';\n    card.innerHTML = `\n        <div class=\"card gradient-border\">\n            <div class=\"event-date\">\n                <h3 class=\"mb-0\">${formatDate(event.eventDate)}</h3>\n            </div>\n            <div class=\"card-body\">\n                <h5 class=\"card-title\">${event.title}</h5>\n                <p class=\"card-text\">${event.description}</p>\n                <div class=\"d-flex justify-content-between align-items-center\">\n                    <span class=\"venue\"><i class=\"fas fa-map-marker-alt\"></i> ${event.venue}</span>\n                    <a href=\"/events/${event.id}\" class=\"btn btn-gradient-primary\">View Details</a>\n                </div>\n            </div>\n        </div>\n    `;\n    return card;\n}\n\n// Date formatting\nfunction formatDate(dateString) {\n    const options = { \n        weekday: 'short', \n        year: 'numeric', \n        month: 'short', \n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n    };\n    return new Date(dateString).toLocaleDateString('en-US', options);\n}\n\n// Initialize on page load\ndocument.addEventListener('DOMContentLoaded', function() {\n    // Form validation\n    const forms = document.querySelectorAll('form[data-validate]');\n    forms.forEach(form => {\n        form.addEventListener('submit', function(e) {\n            if (!validateForm(this)) {\n                e.preventDefault();\n            }\n        });\n    });\n\n    // Image upload preview\n    const imageInputs = document.querySelectorAll('input[type=\"file\"][data-preview]');\n    imageInputs.forEach(input => {\n        input.addEventListener('change', function() {\n            previewImage(this);\n        });\n    });\n\n    // Infinite scroll\n    if (document.querySelector('.event-container')) {\n        window.addEventListener('scroll', () => {\n            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {\n                loadMoreEvents();\n            }\n        });\n    }\n\n    // Initialize all countdowns\n    document.querySelectorAll('[data-countdown]').forEach(element => {\n        initCountdown(element.dataset.countdown, element.id);\n    });\n});","size_bytes":6145},"src/main/java/com/example/sb/demo/repository/UserRepository.java":{"content":"package com.example.sb.demo.repository;\n\nimport com.example.sb.demo.entity.User;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport java.util.Optional;\n\npublic interface UserRepository extends JpaRepository<User, Long> {\n    Optional<User> findByUsername(String username);\n    Optional<User> findByEmail(String email);\n    boolean existsByUsername(String username);\n    boolean existsByEmail(String email);\n}","size_bytes":426},"src/main/java/com/example/sb/demo/controller/EventController.java":{"content":"package com.example.sb.demo.controller;\n\nimport java.io.IOException;\nimport java.nio.file.Files;\nimport java.nio.file.Path;\nimport java.nio.file.Paths;\nimport java.nio.file.StandardCopyOption;\nimport java.time.LocalDateTime;\nimport java.time.LocalTime;\nimport java.util.UUID;\n\nimport org.springframework.stereotype.Controller;\nimport org.springframework.ui.Model;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.ModelAttribute;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.multipart.MultipartFile;\nimport org.springframework.web.servlet.mvc.support.RedirectAttributes;\n\nimport com.example.sb.demo.entity.Event;\nimport com.example.sb.demo.entity.User;\nimport com.example.sb.demo.service.EventService;\nimport com.example.sb.demo.service.RegistrationService;\nimport com.example.sb.demo.service.UserService;\n\nimport jakarta.servlet.http.HttpSession;\n\n@Controller\npublic class EventController {\n\n    private final EventService eventService;\n    private final UserService userService;\n    private final RegistrationService registrationService;\n\n    // ✅ Constructor-based dependency injection for all required services\n\n    public EventController(EventService eventService,\n                           UserService userService,\n                           RegistrationService registrationService) {\n        this.eventService = eventService;\n        this.userService = userService;\n        this.registrationService = registrationService;\n    }\n\n    // ✅ Utility to get currently logged-in user\n    private User getCurrentUser(HttpSession session) {\n        return userService.getCurrentUser(session)\n                .orElseThrow(() -> new RuntimeException(\"Not authenticated\"));\n    }\n\n    @GetMapping(\"/\")\n    public String home(Model model, HttpSession session) {\n        userService.getCurrentUser(session).ifPresent(user -> {\n            model.addAttribute(\"user\", user);\n            model.addAttribute(\"isAdmin\", userService.isAdmin(user));\n        });\n        model.addAttribute(\"upcomingEvents\", eventService.getUpcomingEvents());\n        return \"home\";\n    }\n\n    @GetMapping(\"/events\")\n    public String listEvents(Model model, HttpSession session) {\n        User user = getCurrentUser(session);\n        model.addAttribute(\"user\", user);\n        model.addAttribute(\"isAdmin\", userService.isAdmin(user));\n        model.addAttribute(\"events\", eventService.getAllEvents());\n        return \"events/list\";\n    }\n\n    @GetMapping(\"/events/new\")\n    public String newEventForm(Model model, HttpSession session) {\n        getCurrentUser(session);\n        model.addAttribute(\"event\", new Event());\n        return \"events/form\";\n    }\n\n    @PostMapping(\"/events\")\n    public String createEvent(@RequestParam String eventDate,\n                              @RequestParam String eventTime,\n                              @RequestParam String title,\n                              @RequestParam String description,\n                              @RequestParam String venue,\n                              @RequestParam(required = false) Integer maxParticipants,\n                              @RequestParam(required = false) MultipartFile imageFile,\n                              HttpSession session,\n                              RedirectAttributes redirectAttributes) {\n        try {\n            LocalDateTime eventDateTime = combineDateTime(eventDate, eventTime);\n            if (eventDateTime.isBefore(LocalDateTime.now())) {\n                throw new RuntimeException(\"Event date must be in the future\");\n            }\n\n            Event event = new Event();\n            event.setTitle(title);\n            event.setDescription(description);\n            event.setVenue(venue);\n            event.setMaxParticipants(maxParticipants);\n            event.setEventDate(eventDateTime);\n\n            if (imageFile != null && !imageFile.isEmpty()) {\n                String imageUrl = handleImageUpload(imageFile);\n                event.setImageUrl(imageUrl);\n            }\n\n            User user = getCurrentUser(session);\n            eventService.createEvent(event, user);\n            redirectAttributes.addFlashAttribute(\"successMessage\", \"Event created successfully!\");\n            return \"redirect:/events\";\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n            return \"redirect:/events/new\";\n        }\n    }\n\n    private LocalDateTime combineDateTime(String date, String timeStr) {\n        try {\n            LocalTime time = LocalTime.parse(timeStr);\n            LocalDateTime dateTime = LocalDateTime.parse(date + \"T00:00:00\");\n            return LocalDateTime.of(dateTime.toLocalDate(), time);\n        } catch (Exception e) {\n            throw new RuntimeException(\"Invalid date/time format. Use YYYY-MM-DD and HH:mm.\");\n        }\n    }\n\n    private String handleImageUpload(MultipartFile file) throws IOException {\n        if (file.isEmpty()) return null;\n        String uploadDir = \"uploads/events\";\n        Path uploadPath = Paths.get(uploadDir);\n        if (!Files.exists(uploadPath)) Files.createDirectories(uploadPath);\n\n        String fileName = UUID.randomUUID() + \"_\" + file.getOriginalFilename();\n        Path filePath = uploadPath.resolve(fileName);\n        Files.copy(file.getInputStream(), filePath, StandardCopyOption.REPLACE_EXISTING);\n        return \"/\" + uploadDir + \"/\" + fileName;\n    }\n\n//    @GetMapping(\"/events/{id}/edit\")\n//    public String editEventForm(@PathVariable Long id, Model model, HttpSession session) {\n//        User user = getCurrentUser(session);\n//        Event event = eventService.getEventById(id);\n//\n//        if (!user.getRole().equals(\"ADMIN\") && !event.getCreatedBy().getId().equals(user.getId())) {\n//            throw new RuntimeException(\"Not authorized to edit this event\");\n//        }\n//\n//        model.addAttribute(\"event\", event);\n//        return \"events/form\";\n//    }\n    \n    @GetMapping(\"/events/{id}/edit\")\n    public String editEventForm(@PathVariable Long id, \n                                Model model, \n                                HttpSession session, \n                                RedirectAttributes redirectAttributes) {\n        try {\n            User user = getCurrentUser(session);\n            Event event = eventService.getEventById(id);\n\n            // ✅ Fix: safer and cleaner authorization check\n            boolean isAdmin = \"ADMIN\".equalsIgnoreCase(user.getRole());\n            boolean isCreator = event.getCreatedBy() != null && event.getCreatedBy().getId().equals(user.getId());\n\n            if (!isAdmin && !isCreator) {\n                redirectAttributes.addFlashAttribute(\"errorMessage\", \"You are not authorized to edit this event.\");\n                return \"redirect:/events\";\n            }\n\n            model.addAttribute(\"event\", event);\n            return \"events/form\";\n\n        } catch (RuntimeException e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n            return \"redirect:/events\";\n        }\n    }\n\n\n    @GetMapping(\"/events/{id}\")\n    public String updateEvent(@PathVariable Long id, @ModelAttribute Event event,\n                              HttpSession session, RedirectAttributes redirectAttributes) {\n        try {\n            User user = getCurrentUser(session);\n            eventService.updateEvent(id, event, user);\n            redirectAttributes.addFlashAttribute(\"successMessage\", \"Event updated successfully!\");\n            return \"redirect:/events\";\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n            return \"redirect:/events/\" + id + \"/edit\";\n        }\n    }\n\n    @PostMapping(\"/events/{id}/delete\")\n    public String deleteEvent(@PathVariable Long id, HttpSession session,\n                              RedirectAttributes redirectAttributes) {\n        try {\n            User user = getCurrentUser(session);\n            eventService.deleteEvent(id, user);\n            redirectAttributes.addFlashAttribute(\"successMessage\", \"Event deleted successfully!\");\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n        }\n        return \"redirect:/events\";\n    }\n\n    @PostMapping(\"/events/{id}/register\")\n    public String registerForEvent(@PathVariable Long id, HttpSession session,\n                                   RedirectAttributes redirectAttributes) {\n        try {\n            User user = getCurrentUser(session);\n            Event event = eventService.getEventById(id);\n            registrationService.registerForEvent(event, user);\n            redirectAttributes.addFlashAttribute(\"successMessage\", \"Successfully registered for the event!\");\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n        }\n        return \"redirect:/events\";\n    }\n}\n","size_bytes":9097},"src/main/java/com/example/sb/demo/dto/RegisterRequest.java":{"content":"package com.example.sb.demo.dto;\n\npublic class RegisterRequest {\n\n    private String username;\n    private String password;\n    private String email;\n    private String fullName;\n    private String studentId;\n    private String department;\n    private Integer year;\n    private String role;  // ✅ Role field added\n\n    // ===== Getters and Setters =====\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public String getEmail() {\n        return email;\n    }\n\n    public void setEmail(String email) {\n        this.email = email;\n    }\n\n    public String getFullName() {\n        return fullName;\n    }\n\n    public void setFullName(String fullName) {\n        this.fullName = fullName;\n    }\n\n    public String getStudentId() {\n        return studentId;\n    }\n\n    public void setStudentId(String studentId) {\n        this.studentId = studentId;\n    }\n\n    public String getDepartment() {\n        return department;\n    }\n\n    public void setDepartment(String department) {\n        this.department = department;\n    }\n\n    public Integer getYear() {\n        return year;\n    }\n\n    public void setYear(Integer year) {\n        this.year = year;\n    }\n\n    public String getRole() {\n        return role;\n    }\n\n    public void setRole(String role) {\n        this.role = role;\n    }\n}\n","size_bytes":1543},"src/main/java/com/example/sb/demo/entity/Registration.java":{"content":"package com.example.sb.demo.entity;\n\nimport jakarta.persistence.*;\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport java.time.LocalDateTime;\n\n@Entity\n@Table(name = \"registrations\")\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class Registration {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    public Long getId() {\n\t\treturn id;\n\t}\n\n\tpublic void setId(Long id) {\n\t\tthis.id = id;\n\t}\n\n\tpublic Event getEvent() {\n\t\treturn event;\n\t}\n\n\tpublic void setEvent(Event event) {\n\t\tthis.event = event;\n\t}\n\n\tpublic User getUser() {\n\t\treturn user;\n\t}\n\n\tpublic void setUser(User user) {\n\t\tthis.user = user;\n\t}\n\n\tpublic LocalDateTime getRegistrationDate() {\n\t\treturn registrationDate;\n\t}\n\n\tpublic void setRegistrationDate(LocalDateTime registrationDate) {\n\t\tthis.registrationDate = registrationDate;\n\t}\n\n\tpublic String getStatus() {\n\t\treturn status;\n\t}\n\n\tpublic void setStatus(String status) {\n\t\tthis.status = status;\n\t}\n\n\t@ManyToOne(fetch = FetchType.EAGER)\n    @JoinColumn(name = \"event_id\", nullable = false)\n    private Event event;\n\n    @ManyToOne(fetch = FetchType.EAGER)\n    @JoinColumn(name = \"user_id\", nullable = false)\n    private User user;\n\n    @Column(nullable = false)\n    private LocalDateTime registrationDate;\n\n    private String status; // \"PENDING\", \"APPROVED\", \"REJECTED\"\n\n    @PrePersist\n    protected void onCreate() {\n        registrationDate = LocalDateTime.now();\n        if (status == null) {\n            status = \"PENDING\";\n        }\n    }\n}","size_bytes":1547},"src/test/java/com/example/sb/demo/DemoApplicationTests.java":{"content":"package com.example.sb.demo;\n\nimport org.junit.jupiter.api.Test;\nimport org.springframework.boot.test.context.SpringBootTest;\n\n@SpringBootTest\nclass DemoApplicationTests {\n\n\t@Test\n\tvoid contextLoads() {\n\t}\n\n}\n","size_bytes":209},"src/main/java/com/example/sb/demo/DemoApplication.java":{"content":"package com.example.sb.demo;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class DemoApplication {\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(DemoApplication.class, args);\n\t}\n\n}\n","size_bytes":308},"src/main/java/com/example/sb/demo/dto/LoginRequest.java":{"content":"package com.example.sb.demo.dto;\n\npublic class LoginRequest {\n    public String getUsername() {\n\t\treturn username;\n\t}\n\tpublic void setUsername(String username) {\n\t\tthis.username = username;\n\t}\n\tpublic String getPassword() {\n\t\treturn password;\n\t}\n\tpublic void setPassword(String password) {\n\t\tthis.password = password;\n\t}\n\tprivate String username;\n    private String password;\n}","size_bytes":377},"src/main/resources/static/css/style.css":{"content":"/* Modern Color Gradients */\n:root {\n    --primary-gradient: linear-gradient(135deg, #4F46E5 0%, #7C3AED 50%, #EC4899 100%);\n    --secondary-gradient: linear-gradient(135deg, #2563EB 0%, #7C3AED 50%, #DB2777 100%);\n    --success-gradient: linear-gradient(135deg, #059669 0%, #10B981 50%, #34D399 100%);\n    --danger-gradient: linear-gradient(135deg, #DC2626 0%, #EF4444 50%, #F87171 100%);\n    --dark-gradient: linear-gradient(135deg, #111827 0%, #1F2937 50%, #374151 100%);\n    --light-gradient: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 50%, #E5E7EB 100%);\n    --aurora-gradient: linear-gradient(135deg, #3B82F6 0%, #8B5CF6 25%, #EC4899 50%, #F59E0B 75%, #10B981 100%);\n    --ocean-gradient: linear-gradient(135deg, #0EA5E9 0%, #2563EB 50%, #4F46E5 100%);\n    --sunset-gradient: linear-gradient(135deg, #F59E0B 0%, #DB2777 50%, #4F46E5 100%);\n    --forest-gradient: linear-gradient(135deg, #059669 0%, #0EA5E9 50%, #6366F1 100%);\n}\n\n/* Custom Button Styles */\n.btn-gradient-primary {\n    background: var(--primary-gradient);\n    border: none;\n    color: white;\n    transition: all 0.3s ease;\n}\n\n.btn-gradient-primary:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n}\n\n/* Card Styles */\n.card {\n    border: none;\n    border-radius: 15px;\n    transition: all 0.3s ease;\n    background: white;\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n}\n\n.card:hover {\n    /*transform: translateY(-5px);*/\n    box-shadow: 0 20px 25px 5px rgba(1, 1, 1, 1);\n}\n\n.card.gradient-border {\n    position: relative;\n    background: white;\n    background-clip: padding-box;\n    border: solid 2px transparent;\n}\n\n.card.gradient-border::before {\n    content: '';\n    position: absolute;\n    top: 0; right: 0; bottom: 0; left: 0;\n    z-index: -1;\n    margin: -2px;\n    border-radius: inherit;\n    background: var(--primary-gradient);\n}\n\n/* Navbar Styling */\n.navbar.gradient-nav {\n    background: var(--dark-gradient);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n/* Hero Section */\n.hero-section {\n    background: var(--primary-gradient);\n    color: white;\n    padding: 6rem 0;\n    position: relative;\n    overflow: hidden;\n}\n\n.hero-section::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: url('/images/pattern.svg') center/cover;\n    opacity: 0.1;\n}\n\n/* Event Cards */\n.event-card {\n    border-radius: 20px;\n    overflow: hidden;\n    transition: all 0.3s ease;\n}\n\n.event-card:hover {\n    /*transform: translateY(-10px);*/\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);\n}\n\n\n.event-card .event-date {\n    background: var(--primary-gradient);\n    color: white;\n    padding: 1rem;\n    text-align: center;\n}\n\n/* Form Styling */\n.gradient-form {\n    background: white;\n    border-radius: 20px;\n    padding: 2rem;\n    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n}\n\n.form-control {\n    border-radius: 10px;\n    border: 2px solid #e2e8f0;\n    padding: 0.75rem 1rem;\n    transition: all 0.3s ease;\n}\n\n.form-control:focus {\n    border-color: #6366f1;\n    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);\n}\n\n/* Animations */\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.animate-fade-in-up {\n    animation: fadeInUp 0.6s ease-out;\n}\n\n/* Loading Spinner */\n.loading-spinner {\n    width: 40px;\n    height: 40px;\n    border: 4px solid #f3f3f3;\n    border-top: 4px solid #6366f1;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n/* Notifications */\n.notification {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    padding: 1rem 2rem;\n    border-radius: 10px;\n    color: white;\n    transform: translateX(100%);\n    animation: slideIn 0.3s forwards;\n    z-index: 1000;\n}\n\n@keyframes slideIn {\n    to {\n        transform: translateX(0);\n    }\n}\n\n.notification.success {\n    background: var(--success-gradient);\n}\n\n.notification.error {\n    background: var(--danger-gradient);\n}\n\n/* Dashboard Stats */\n.stat-card {\n    background: var(--aurora-gradient);\n    color: white;\n    border-radius: 1.5rem;\n    padding: 2rem;\n    margin: 1.5rem 0;\n    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    background-size: 200% 200%;\n    animation: gradientShift 10s ease infinite;\n}\n\n.stat-card:hover {\n    transform: translateY(-5px) scale(1.02);\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 8px 10px -6px rgba(0, 0, 0, 0.2);\n    background-position: right center;\n}\n\n@keyframes gradientShift {\n    0% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n    100% { background-position: 0% 50%; }\n}\n\n/* Stat card variants */\n.stat-card.events { background: var(--ocean-gradient); }\n.stat-card.users { background: var(--sunset-gradient); }\n.stat-card.registrations { background: var(--forest-gradient); }\n\n/* Responsive Design */\n@media (max-width: 768px) {\n    .hero-section {\n        padding: 4rem 0;\n    }\n    \n    .event-card:hover {\n        transform: none;\n    }\n}\n\n/* Custom Scrollbar */\n::-webkit-scrollbar {\n    width: 8px;\n}\n\n::-webkit-scrollbar-track {\n    background: #f1f1f1;\n}\n\n::-webkit-scrollbar-thumb {\n    background: var(--primary-gradient);\n    border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: var(--secondary-gradient);\n}","size_bytes":5520},"src/main/java/com/example/sb/demo/controller/UserController.java":{"content":"package com.example.sb.demo.controller;\n\n\n\nimport com.example.sb.demo.entity.User;\nimport com.example.sb.demo.service.UserService;\nimport jakarta.servlet.http.HttpSession;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.ui.Model;\nimport org.springframework.web.bind.annotation.GetMapping;\n\n@Controller\npublic class UserController {\n\n    private final UserService userService;\n\n    public UserController(UserService userService) {\n        this.userService = userService;\n    }\n\n    @GetMapping(\"/user/home\")\n    public String userHome(HttpSession session, Model model) {\n        User user = userService.getCurrentUser(session)\n                .orElseThrow(() -> new RuntimeException(\"You must log in first!\"));\n\n        model.addAttribute(\"user\", user);\n        model.addAttribute(\"isAdmin\", userService.isAdmin(user));\n        return \"user/home\"; // ✅ matches the new template\n    }\n}\n","size_bytes":916},"src/main/java/com/example/sb/demo/repository/EventRepository.java":{"content":"package com.example.sb.demo.repository;\n\nimport java.time.LocalDateTime;\nimport java.util.List;\n\nimport org.springframework.data.jpa.repository.JpaRepository;\n\nimport com.example.sb.demo.entity.Event;\nimport com.example.sb.demo.entity.User;\n\npublic interface EventRepository extends JpaRepository<Event, Long> {\n    List<Event> findByCreatedBy(User user);\n    List<Event> findByEventDateAfterOrderByEventDateAsc(LocalDateTime date);\n    List<Event> findByEventDateBeforeOrderByEventDateDesc(LocalDateTime date);\n    List<Event> findAllByOrderByEventDateDesc();\n}\n","size_bytes":563},"src/main/java/com/example/sb/demo/service/UserService.java":{"content":"package com.example.sb.demo.service;\n\nimport java.time.LocalDateTime;\nimport java.util.List;\nimport java.util.Objects;\nimport java.util.Optional;\nimport java.util.stream.Collectors;\n\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport com.example.sb.demo.dto.LoginRequest;\nimport com.example.sb.demo.dto.RegisterRequest;\nimport com.example.sb.demo.entity.User;\nimport com.example.sb.demo.repository.UserRepository;\n\nimport jakarta.servlet.http.HttpSession;\n\n@Service\npublic class UserService {\n\n    private final UserRepository userRepository;\n    private static final String USER_SESSION_KEY = \"user_id\";\n    private static final String USER_ROLE_KEY = \"user_role\";\n\n  \n    public UserService(UserRepository userRepository) {\n        this.userRepository = userRepository;\n    }\n\n    // ==============================\n    // STUDENT REGISTRATION\n    // ==============================\n    @Transactional\n    public User registerUser(RegisterRequest request) {\n        if (userRepository.existsByUsername(request.getUsername())) {\n            throw new RuntimeException(\"Username already exists\");\n        }\n        if (userRepository.existsByEmail(request.getEmail())) {\n            throw new RuntimeException(\"Email already exists\");\n        }\n\n        User user = new User();\n        user.setUsername(request.getUsername());\n        user.setPassword(request.getPassword()); // ⚠️ Should be hashed in production\n        user.setEmail(request.getEmail());\n        user.setFullName(request.getFullName());\n        user.setStudentId(request.getStudentId());\n        user.setDepartment(request.getDepartment());\n        user.setYear(request.getYear());\n        user.setRole(\"STUDENT\"); // Force role for normal registration\n\n        return userRepository.save(user);\n    }\n\n    // ==============================\n    // ADMIN REGISTRATION\n    // ==============================\n    @Transactional\n    public User registerAdmin(RegisterRequest request) {\n        if (userRepository.existsByUsername(request.getUsername())) {\n            throw new RuntimeException(\"Username already exists\");\n        }\n        if (userRepository.existsByEmail(request.getEmail())) {\n            throw new RuntimeException(\"Email already exists\");\n        }\n\n        User user = new User();\n        user.setUsername(request.getUsername());\n        user.setPassword(request.getPassword());\n        user.setEmail(request.getEmail());\n        user.setFullName(request.getFullName());\n        user.setDepartment(request.getDepartment());\n        user.setYear(request.getYear());\n        user.setRole(\"ADMIN\"); // ✅ Important\n\n        return userRepository.save(user);\n    }\n\n\n    // ==============================\n    // LOGIN + SESSION MANAGEMENT\n    // ==============================\n    public Optional<User> authenticateUser(LoginRequest request) {\n        return userRepository.findByUsername(request.getUsername())\n                .filter(user -> user.getPassword().equals(request.getPassword()));\n    }\n\n//    public void login(HttpSession session, User user) {\n//        session.setAttribute(USER_SESSION_KEY, user.getId());\n//        session.setAttribute(USER_ROLE_KEY, user.getRole());\n//    }\n    \n    public void login(HttpSession session, User user) {\n        session.setAttribute(\"user\", user);\n        session.setAttribute(\"user_role\", user.getRole());\n    }\n\n    public void logout(HttpSession session) {\n        session.invalidate();\n    }\n\n//    public Optional<User> getCurrentUser(HttpSession session) {\n//        Object userId = session.getAttribute(USER_SESSION_KEY);\n//        if (userId != null) {\n//            return userRepository.findById((Long) userId);\n//        }\n//        return Optional.empty();\n//    }\n    \n    public Optional<User> getCurrentUser(HttpSession session) {\n        Object userObj = session.getAttribute(\"user\");\n        if (userObj instanceof User user) {\n            return Optional.of(user);\n        }\n        return Optional.empty();\n    }\n\n    // ==============================\n    // ADMIN OPERATIONS\n    // ==============================\n    @Transactional\n    public User updateUserRole(Long userId, String role, User admin) {\n        if (!isAdmin(admin)) {\n            throw new RuntimeException(\"Only admins can update user roles\");\n        }\n\n        User user = userRepository.findById(userId)\n                .orElseThrow(() -> new RuntimeException(\"User not found\"));\n\n        if (user.getId().equals(admin.getId())) {\n            throw new RuntimeException(\"Cannot modify your own role\");\n        }\n\n        user.setRole(role);\n        return userRepository.save(user);\n    }\n\n    @Transactional\n    public User updateUserStatus(Long userId, boolean active, User admin) {\n        if (!isAdmin(admin)) {\n            throw new RuntimeException(\"Only admins can update user status\");\n        }\n\n        User user = userRepository.findById(userId)\n                .orElseThrow(() -> new RuntimeException(\"User not found\"));\n\n        if (user.getId().equals(admin.getId())) {\n            throw new RuntimeException(\"Cannot modify your own status\");\n        }\n\n        // If you add `active` field in User entity, uncomment this:\n        // user.setActive(active);\n\n        return userRepository.save(user);\n    }\n\n    // ==============================\n    // UTILITIES\n    // ==============================\n    public List<User> getAllUsers() {\n        return userRepository.findAll();\n    }\n\n    public List<String> getAllDepartments() {\n        return userRepository.findAll().stream()\n                .map(User::getDepartment)\n                .filter(Objects::nonNull)\n                .distinct()\n                .collect(Collectors.toList());\n    }\n\n    public List<User> getUsersByDateRange(LocalDateTime start, LocalDateTime end) {\n        return getAllUsers();\n    }\n\n    public boolean isAdmin(User user) {\n        return \"ADMIN\".equalsIgnoreCase(user.getRole());\n    }\n\n    public boolean isStudent(User user) {\n        return \"STUDENT\".equalsIgnoreCase(user.getRole());\n    }\n}\n","size_bytes":6092},"src/main/java/com/example/sb/demo/controller/AuthController.java":{"content":"package com.example.sb.demo.controller;\n\nimport org.springframework.stereotype.Controller;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.ModelAttribute;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.servlet.mvc.support.RedirectAttributes;\n\nimport com.example.sb.demo.dto.LoginRequest;\nimport com.example.sb.demo.dto.RegisterRequest;\nimport com.example.sb.demo.service.UserService;\n\nimport jakarta.servlet.http.HttpSession;\n\n@Controller\npublic class AuthController {\n\n    private final UserService userService;\n\n    // ✅ Constructor-based dependency injection (best practice)\n \n    public AuthController(UserService userService) {\n        this.userService = userService;\n    }\n\n    // ======================================================\n    // LOGIN\n    // ======================================================\n    @GetMapping(\"/login\")\n    public String loginPage() {\n        return \"auth/login\";\n    }\n\n    @PostMapping(\"/login\")\n    public String login(@ModelAttribute LoginRequest loginRequest,\n                        HttpSession session,\n                        RedirectAttributes redirectAttributes) {\n        try {\n            return userService.authenticateUser(loginRequest)\n                    .map(user -> {\n                        // ✅ Save user info in session\n                        userService.login(session, user);\n\n                        redirectAttributes.addFlashAttribute(\"successMessage\",\n                                \"Welcome back, \" + user.getFullName() + \"!\");\n\n                        // ✅ Redirect based on role\n                        if (userService.isAdmin(user)) {\n                            return \"redirect:/admin/dashboard\";\n                        } else {\n                            return \"redirect:/user/home\"; // ✅ Correct student redirect\n                        }\n                    })\n                    .orElseThrow(() -> new RuntimeException(\"Invalid username or password.\"));\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n            return \"redirect:/login\";\n        }\n    }\n\n    // ======================================================\n    // ADMIN REGISTRATION\n    // ======================================================\n    @GetMapping(\"/admin/register\")\n    public String adminRegisterPage() {\n        return \"auth/admin-register\";\n    }\n\n    @PostMapping(\"/admin/register\")\n    public String registerAdmin(@ModelAttribute RegisterRequest registerRequest,\n                                RedirectAttributes redirectAttributes) {\n        try {\n            // ✅ Force role as ADMIN (even if the form doesn’t send it)\n            registerRequest.setRole(\"ADMIN\");\n            userService.registerAdmin(registerRequest);\n\n            redirectAttributes.addFlashAttribute(\"successMessage\",\n                    \"Admin registered successfully! Please login.\");\n            return \"redirect:/login\";\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n            return \"redirect:/admin/register\"; // ✅ Corrected path\n        }\n    }\n\n    // ======================================================\n    // STUDENT REGISTRATION\n    // ======================================================\n    @GetMapping(\"/register\")\n    public String registerPage() {\n        return \"auth/register\";\n    }\n\n    @PostMapping(\"/register\")\n    public String register(@ModelAttribute RegisterRequest registerRequest,\n                           RedirectAttributes redirectAttributes) {\n        try {\n            userService.registerUser(registerRequest);\n            redirectAttributes.addFlashAttribute(\"successMessage\",\n                    \"Registration successful! Please login.\");\n            return \"redirect:/login\";\n        } catch (Exception e) {\n            redirectAttributes.addFlashAttribute(\"errorMessage\", e.getMessage());\n            return \"redirect:/register\";\n        }\n    }\n\n    // ======================================================\n    // LOGOUT\n    // ======================================================\n    @GetMapping(\"/logout\")\n    public String logout(HttpSession session, RedirectAttributes redirectAttributes) {\n        userService.logout(session);\n        redirectAttributes.addFlashAttribute(\"successMessage\",\n                \"You have been logged out successfully.\");\n        return \"redirect:/login\";\n    }\n}\n","size_bytes":4533},"src/main/java/com/example/sb/demo/service/RegistrationService.java":{"content":"package com.example.sb.demo.service;\n\nimport java.nio.charset.StandardCharsets;\nimport java.time.LocalDateTime;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport com.example.sb.demo.entity.Event;\nimport com.example.sb.demo.entity.Registration;\nimport com.example.sb.demo.entity.User;\nimport com.example.sb.demo.repository.RegistrationRepository;\n\nimport lombok.RequiredArgsConstructor;\n\n@Service\n@RequiredArgsConstructor\npublic class RegistrationService {\n    private final RegistrationRepository registrationRepository;\n   \n    public RegistrationService(RegistrationRepository registrationRepository) {\n    \tthis.registrationRepository=registrationRepository;\n    }\n    @Transactional\n    public Registration registerForEvent(Event event, User user) {\n        if (registrationRepository.existsByEventAndUser(event, user)) {\n            throw new RuntimeException(\"Already registered for this event\");\n        }\n\n        Registration registration = new Registration();\n        registration.setEvent(event);\n        registration.setUser(user);\n        registration.setStatus(\"PENDING\");\n\n        return registrationRepository.save(registration);\n    }\n\n    public List<Registration> getEventRegistrations(Event event) {\n        return registrationRepository.findByEvent(event);\n    }\n\n    public List<Registration> getAllRegistrations() {\n        return registrationRepository.findAll();\n    }\n\n    public List<Registration> getUserRegistrations(User user) {\n        return registrationRepository.findByUser(user);\n    }\n\n    @Transactional\n    public Registration updateRegistrationStatus(Long registrationId, String status, User admin) {\n        if (!admin.getRole().equals(\"ADMIN\")) {\n            throw new RuntimeException(\"Only admins can update registration status\");\n        }\n\n        Registration registration = registrationRepository.findById(registrationId)\n                .orElseThrow(() -> new RuntimeException(\"Registration not found\"));\n\n        registration.setStatus(status);\n        return registrationRepository.save(registration);\n    }\n\n    @Transactional\n    public Registration updateRegistrationStatus(Long registrationId, String status, String comment, User admin) {\n        // comment is accepted but not persisted (Registration has no comment field)\n        return updateRegistrationStatus(registrationId, status, admin);\n    }\n\n    public List<Registration> getPendingRegistrations() {\n        return registrationRepository.findAll().stream()\n                .filter(r -> \"PENDING\".equals(r.getStatus()))\n                .collect(Collectors.toList());\n    }\n\n    public List<Registration> getRegistrationsByDateRange(LocalDateTime start, LocalDateTime end) {\n        return registrationRepository.findAll().stream()\n                .filter(r -> r.getRegistrationDate() != null &&\n                        (r.getRegistrationDate().isEqual(start) || r.getRegistrationDate().isAfter(start)) &&\n                        (r.getRegistrationDate().isEqual(end) || r.getRegistrationDate().isBefore(end)))\n                .collect(Collectors.toList());\n    }\n\n    public byte[] exportRegistrations(Long eventId, String format) {\n        List<Registration> regs = (eventId == null)\n                ? getAllRegistrations()\n                : registrationRepository.findByEvent(getEventById(eventId));\n\n        // Simple CSV export for now\n        StringBuilder sb = new StringBuilder();\n        sb.append(\"Registration ID,Event ID,Event Title,User ID,Username,Email,Status,Date\\n\");\n        for (Registration r : regs) {\n            sb.append(r.getId()).append(',')\n              .append(r.getEvent().getId()).append(',')\n              .append(escapeCsv(r.getEvent().getTitle())).append(',')\n              .append(r.getUser().getId()).append(',')\n              .append(escapeCsv(r.getUser().getUsername())).append(',')\n              .append(escapeCsv(r.getUser().getEmail())).append(',')\n              .append(r.getStatus()).append(',')\n              .append(r.getRegistrationDate()).append('\\n');\n        }\n        return sb.toString().getBytes(StandardCharsets.UTF_8);\n    }\n\n    private String escapeCsv(String s) {\n        if (s == null) return \"\";\n        if (s.contains(\",\") || s.contains(\"\\n\") || s.contains(\"\\\"\")) {\n            return '\"' + s.replace(\"\\\"\", \"\\\"\\\"\") + '\"';\n        }\n        return s;\n    }\n\n    // helper to resolve event when exporting by id\n    private Event getEventById(Long eventId) {\n        return registrationRepository.findAll().stream()\n                .map(Registration::getEvent)\n                .filter(e -> e != null && e.getId().equals(eventId))\n                .findFirst()\n                .orElseThrow(() -> new RuntimeException(\"Event not found: \" + eventId));\n    }\n\n    @Transactional\n    public void cancelRegistration(Long registrationId, User user) {\n        Registration registration = registrationRepository.findById(registrationId)\n                .orElseThrow(() -> new RuntimeException(\"Registration not found\"));\n\n        if (!registration.getUser().getId().equals(user.getId())) {\n            throw new RuntimeException(\"Not authorized to cancel this registration\");\n        }\n\n        registrationRepository.delete(registration);\n    }\n}","size_bytes":5338}},"version":2}